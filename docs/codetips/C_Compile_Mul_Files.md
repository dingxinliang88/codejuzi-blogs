# C文件多文件编译

## 编译

在使用多文件编译时，需要注意一些细节，确保每个文件都被正确编译和链接。您遇到的链接错误表明编译器无法找到定义在某个文件中的函数。

下面是一些可能导致这个问题的原因和解决方案：

1. 您需要将实现文件编译成目标文件，并将其与其他目标文件一起链接起来。例如，在您的示例中，您可以执行以下命令：

   ```bash
   gcc -c test2/demo.c -o test2/demo.o
   gcc -c test2/cal.c -o test2/cal.o
   gcc test2/demo.o test2/cal.o -o test2/demo
   ```

   这将先将`demo.c`编译成目标文件`demo.o`，然后将其与另一个目标文件`cal.o`链接起来，生成可执行文件`demo`。

2. 您需要在`cal.c`文件中提供函数定义。在C语言中，函数的声明只是告诉编译器该函数的名称、参数类型和返回类型，而函数的定义则提供该函数的实际代码。因此，如果您在`cal.c`中只提供了函数声明而没有提供定义，则编译器将无法找到函数的实际代码，从而导致链接错误。为了解决这个问题，您需要在`cal.c`中提供函数定义，例如：

   ```c
   int cal(int a, int b) {
       return a + b;
   }
   ```

   然后将`cal.c`和`cal.h`一起编译成目标文件，并将其与`demo.o`一起链接起来，例如：

   ```bash
   gcc -c test2/cal.c -o test2/cal.o
   gcc test2/demo.o test2/cal.o -o test2/demo
   ```

3. 您需要在`demo.c`文件中包含`cal.h`头文件。头文件包含函数声明，让编译器知道函数的名称、参数类型和返回类型。如果您在`demo.c`中没有包含`cal.h`头文件，则编译器将无法识别`cal`函数，并在链接时生成错误。为了解决这个问题，您需要在`demo.c`文件顶部添加以下行：

   ```c
   #include "cal.h"
   ```

   这将包含`cal.h`头文件，使编译器能够识别`cal`函数。

请注意，当使用多个文件时，确保在链接时包含所有必要的目标文件。您可以使用上述命令来编译和链接文件。

## 运行

```bash
./test2/demo
```

## 总结

- 把所有需要运行的C文件先编译成`.o`
- 最后把所有`.o`文件一起gcc成一个可执行文件