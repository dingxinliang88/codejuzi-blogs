# Docker æ­å»º Redis åˆ†å¸ƒå¼é›†ç¾¤

# é¢è¯•é¢˜ï¼š1~2äº¿æ¡æ•°æ®éœ€è¦ç¼“å­˜ï¼Œå¦‚ä½•è®¾è®¡ç¼“å­˜ç­–ç•¥ï¼Ÿ

å•æœºæ˜¯ä¸å¯èƒ½å•æœºçš„å•¦ï¼Œè¿™è¾ˆå­éƒ½æ˜¯ä¸å¯èƒ½å•æœºçš„å•¦~ï¼Œè‚¯å®šæ˜¯éœ€è¦åˆ†å¸ƒå¼ç¼“å­˜ï¼ä½¿ç”¨Rediså¦‚ä½•è½åœ°å‘¢ï¼Ÿ

## ç­–ç•¥ä¸€ï¼šå“ˆå¸Œå–ä½™åˆ†åŒº

![image-20230509194744330](assets/image-20230509194744330.png)

å‡è®¾æœ‰3å°æœºå™¨æ„æˆä¸€ä¸ªé›†ç¾¤ï¼Œç”¨æˆ·æ¯æ¬¡è¯»å†™æ“ä½œéƒ½æ˜¯æ ¹æ®å…¬å¼ï¼š`hash(key) % Nä¸ªæœºå™¨å°æ•°`è®¡ç®—å‡ºå“ˆå¸Œå€¼ï¼Œç”¨æ¥å†³å®šæ•°æ®æ˜ å°„åˆ°é‚£ä¸€ä¸ªèŠ‚ç‚¹ä¸Šã€‚

### ä¼˜ç‚¹

- ç®€å•ç²—æš´ã€ç›´æ¥æœ‰æ•ˆï¼Œåªéœ€è¦é¢„ä¼°å¥½æ•°æ®è§„åˆ’å¥½èŠ‚ç‚¹å°±èƒ½ä¿è¯ä¸€æ®µæ—¶é—´çš„æ•°æ®æ”¯æ’‘
- ä½¿ç”¨Hashç®—æ³•è®©å›ºå®šçš„ä¸€éƒ¨åˆ†è¯·æ±‚è½åˆ°åŒä¸€å°æœåŠ¡å™¨ä¸Šï¼Œè¿™æ ·æ¯ä¸€å°æœåŠ¡å™¨å›ºå®šå¤„ç†ä¸€éƒ¨åˆ†è¯·æ±‚ï¼Œå¹¶ç»´æŠ¤è¿™äº›è¯·æ±‚çš„ä¿¡æ¯ï¼Œèµ·åˆ°è´Ÿè½½å‡è¡¡å’Œåˆ†è€Œæ²»ä¹‹çš„ä½œç”¨

### ç¼ºç‚¹

åŸæ¥è§„åˆ’å¥½çš„ç»“ç‚¹ï¼Œè¿›è¡Œæ‰©å®¹æˆ–è€…ç¼©å®¹éƒ½æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ã€‚ä¸ç®¡æ˜¯æ‰©å®¹è¿˜æ˜¯ç¼©å®¹ï¼Œæ¯æ¬¡æ•°æ®å˜åŠ¨å¯¼è‡´èŠ‚ç‚¹å˜åŠ¨ï¼Œæ˜ å°„å…³ç³»éƒ½éœ€è¦é‡æ–°è®¡ç®—ï¼Œåœ¨æœåŠ¡å™¨ä¸ªæ•°å›ºå®šä¸å˜æ—¶æ²¡æœ‰é—®é¢˜ï¼Œå¦‚æœéœ€è¦å¼¹æ€§æ‰©å®¹æˆ–è€…æ•…éšœåœæœºçš„æƒ…å†µä¸‹ï¼ŒåŸæ¥çš„å–æ¨¡å…¬å¼å°±ä¼šå‘ç”Ÿå˜åŒ–`hash(key)/N` => `hash(key) / ?`ï¼Œæ­¤æ—¶åœ°å€ç»è¿‡å–ä½™è¿ç®—ï¼Œç»“æœä¹Ÿä¼šå‘ç”Ÿå¾ˆå¤§å˜åŒ–ï¼Œæ ¹æ®å…¬å¼è·å–çš„æœåŠ¡å™¨èŠ‚ç‚¹ä¹Ÿä¼šå˜å¾—ä¸å¯æ§ã€‚è‹¥æŸä¸ªRedisèŠ‚ç‚¹å®•æœºäº†ï¼Œç”±äºæœºå™¨å°æ•°çš„å˜åŒ–ï¼Œä¼šå¯¼è‡´hashå–ä½™å…¨éƒ¨æ•°æ®é‡æ–°æ´—ç‰Œã€‚



## ç­–ç•¥2ï¼šä¸€è‡´æ€§å“ˆå¸Œç®—æ³•åˆ†åŒº

æå‡ºä¸€è‡´æ€§å“ˆå¸Œç®—æ³•çš„ç›®çš„æ˜¯å½“æœåŠ¡å™¨ä¸ªæ•°å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå°½å¯èƒ½çš„å‡å°‘å½±å“å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨çš„æ˜ å°„å…³ç³»ã€‚

### ä¸‰å¤§æ­¥éª¤

#### 1ï¼‰ä¸€è‡´æ€§å“ˆå¸Œç¯

ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å¿…ç„¶æœ‰hashå‡½æ•°å¹¶æŒ‰ç…§ç®—æ³•ç”Ÿæˆhashå€¼ï¼Œè¿™ä¸ªç®—æ³•çš„æ‰€æœ‰å¯èƒ½hashå€¼ä¼šæ„æˆä¸€ä¸ªå…¨é‡é›†ï¼Œè¿™ä¸ªé›†åˆå¯ä»¥æˆä¸ºä¸€ä¸ªhashç©ºé—´ã€0 ~ 2^32^-1ã€‘ï¼Œè¿™æ˜¯ä¸€ä¸ªçº¿æ€§ç©ºé—´ï¼Œä½†æ˜¯åœ¨ç®—æ³•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é€‚å½“çš„é€»è¾‘æ§åˆ¶å°†ä»–é¦–å°¾ç›¸è¿`0 = 2^32`ï¼Œä½¿å¾—å®ƒåœ¨é€»è¾‘ä¸Šå½¢æˆä¸€ä¸ªç¯å½¢ç©ºé—´ã€‚

ã€æ —å­ğŸŒ°ã€‘

![image-20230509200630800](assets/image-20230509200630800.png)



#### 2ï¼‰èŠ‚ç‚¹æ˜ å°„

å°†é›†ç¾¤ä¸­çš„å„ä¸ªIPèŠ‚ç‚¹æ˜ å°„åˆ°ç¯ä¸Šçš„æŸä¸€ä¸ªä½ç½®ã€‚å°†å„ä¸ªæœåŠ¡å™¨ï¼ˆIPã€ä¸»æœºåç­‰ï¼‰ä½¿ç”¨hashç®—æ³•è¿›è¡Œhashå–ä½™ï¼Œç¡®å®šæ¯å°æœåŠ¡å™¨åœ¨å“ˆå–œæ¬¢ä¸Šçš„ä½ç½®

ã€æ —å­ğŸŒ°ã€‘4ä¸ªèŠ‚ç‚¹Aã€Bã€Cã€Dï¼Œç»è¿‡IPåœ°å€å“ˆå¸Œè®¡ç®—ä¹‹åï¼Œåœ¨ç¯ä¸Šçš„ä½ç½®å¦‚ä¸‹å›¾ï¼š

![image-20230509200940260](assets/image-20230509200940260.png)



#### 3ï¼‰keyçš„è½é”®è§„åˆ™

å½“æˆ‘ä»¬éœ€è¦å­˜å‚¨ä¸€ä¸ªKVé”®å€¼å¯¹çš„æ—¶å€™ï¼Œé¦–å…ˆè®¡ç®—keyçš„hashå€¼ç¡®å®šæ­¤æ•°æ®åœ¨ç¯ä¸Šçš„ä½ç½®ï¼Œä»æ­¤ä½ç½®æ²¿ç¯é¡ºæ—¶é’ˆâ€œè¡Œèµ°â€ï¼Œç¬¬ä¸€å°é‡åˆ°çš„æœåŠ¡å™¨å°±æ˜¯å…¶åº”è¯¥å®šä½åˆ°çš„æœåŠ¡å™¨ï¼Œå¹¶å°†è¯¥é”®å€¼å¯¹å­˜å‚¨åœ¨è¯¥èŠ‚ç‚¹ä¸Šã€‚

ã€æ —å­ğŸŒ°ã€‘ObjectAã€ObjectBã€ObjectCã€ObjectDå››ä¸ªå¯¹è±¡ï¼Œç»è¿‡å“ˆå¸Œè®¡ç®—åï¼Œåœ¨ç¯ç©ºé—´ä¸Šçš„ä½ç½®å¦‚ä¸‹ï¼šæ ¹æ®ä¸€è‡´æ€§Hashç®—æ³•ï¼Œæ•°æ®Aä¼šè¢«å®šä¸ºåˆ°Node Aä¸Šï¼ŒBè¢«å®šä¸ºåˆ°Node Bä¸Šï¼ŒCè¢«å®šä¸ºåˆ°Node Cä¸Šï¼ŒDè¢«å®šä¸ºåˆ°Node Dä¸Š

![image-20230509201333341](assets/image-20230509201333341.png)



### ä¼˜ç‚¹

#### 1ã€å®¹é”™æ€§

å‡è®¾NodeCå®•æœºï¼Œæ­¤æ—¶å¯¹è±¡Aã€Bã€Dä¸ä¼šå—åˆ°å½±å“ï¼Œåªæœ‰Cå¯¹è±¡è¢«é‡å®šä½åˆ°NodeDã€‚åœ¨ä¸€è‡´æ€§Hashç®—æ³•ä¸­ï¼Œå¦‚æœä¸€å°æœåŠ¡å™¨ä¸å¯ç”¨ï¼Œåˆ™å—å½±å“çš„æ•°æ®ä»…ä»…æ˜¯æ­¤æœåŠ¡å™¨åˆ°å…¶ç¯ç©ºé—´ä¸­å‰ä¸€å°æœåŠ¡å™¨ï¼ˆå³æ²¿ç€é€†æ—¶é’ˆæ–¹å‘è¡Œèµ°é‡åˆ°çš„ç¬¬ä¸€å°æœåŠ¡å™¨ï¼‰ä¹‹é—´æ•°æ®ï¼Œå…¶å®ƒä¸ä¼šå—åˆ°å½±å“ã€‚

ã€æ —å­ğŸŒ°ã€‘CèŠ‚ç‚¹å®•æœºäº†ï¼Œå—åˆ°å½±å“çš„åªæ˜¯Bã€Cä¹‹é—´çš„æ•°æ®ï¼Œå¹¶ä¸”è¿™äº›æ•°æ®ä¼šè½¬ç§»åˆ°Dè¿›è¡Œå­˜å‚¨ã€‚

![image-20230509201525126](assets/image-20230509201525126.png)

#### 2ã€æ‰©å±•æ€§

ç”±äºæ•°æ®é‡å¢åŠ å¯¼è‡´éœ€è¦å¢åŠ ä¸€å°èŠ‚ç‚¹NodeXï¼ŒXçš„ä½ç½®åœ¨Aå’ŒBä¹‹é—´ï¼Œå—åˆ°å½±å“çš„ä¹Ÿå°±æ˜¯Aåˆ°Xä¹‹é—´çš„æ•°æ®ï¼Œé‡æ–°æŠŠAåˆ°Xçš„æ•°æ®å½•å…¥åˆ°Xä¸Šå³å¯ï¼Œä¸ä¼šå¯¼è‡´hashå–ä½™å…¨éƒ¨æ•°æ®é‡æ–°æ´—ç‰Œ

![image-20230509201635835](assets/image-20230509201635835.png)

### ç¼ºç‚¹

ä¸€è‡´æ€§Hashçš„æ•°æ®å€¾æ–œé—®é¢˜ï¼šä¸€è‡´æ€§Hashç®—æ³•åœ¨æœåŠ¡**èŠ‚ç‚¹å¤ªå°‘æ—¶**ï¼Œå®¹æ˜“å› ä¸ºèŠ‚ç‚¹åˆ†å¸ƒä¸å‡åŒ€è€Œé€ æˆ**æ•°æ®å€¾æ–œ**ï¼ˆè¢«ç¼“å­˜çš„å¯¹è±¡å¤§éƒ¨åˆ†é›†ä¸­ç¼“å­˜åœ¨æŸä¸€å°æœåŠ¡å™¨ä¸Šï¼‰é—®é¢˜

ã€æ —å­ğŸŒ°ã€‘ä¸¤å°æœåŠ¡å™¨èŠ‚ç‚¹

![image-20230509201739756](assets/image-20230509201739756.png)



## ç­–ç•¥3ï¼šå“ˆå¸Œæ§½åˆ†åŒº

è§£å†³å‡åŒ€åˆ†é…çš„é—®é¢˜ï¼Œåœ¨æ•°æ®å’ŒèŠ‚ç‚¹ä¹‹é—´åˆåŠ å…¥äº†ä¸€å±‚ï¼ŒæŠŠè¿™å±‚ç§°ä¸ºå“ˆå¸Œæ§½ï¼ˆslotï¼‰ï¼Œç”¨äºç®¡ç†æ•°æ®å’ŒèŠ‚ç‚¹ä¹‹é—´çš„å…³ç³»ï¼Œç°åœ¨å°±ç›¸å½“äºèŠ‚ç‚¹ä¸Šæ”¾çš„æ˜¯æ§½ï¼Œæ§½é‡Œæ”¾çš„æ˜¯æ•°æ®ã€‚

![image-20230509202001669](assets/image-20230509202001669.png)

- æ§½è§£å†³çš„æ˜¯ç²’åº¦é—®é¢˜ï¼Œç›¸å½“äºæŠŠç²’åº¦å˜å¤§äº†ï¼Œä¾¿äºæ•°æ®ç§»åŠ¨
- å“ˆå¸Œè§£å†³çš„æ˜¯æ˜ å°„é—®é¢˜ï¼Œä½¿ç”¨keyçš„å“ˆå¸Œå€¼æ¥è®¡ç®—æ‰€åœ¨çš„æ§½ï¼Œä¾¿äºæ•°æ®åˆ†é…

ä¸€ä¸ªé›†ç¾¤åªèƒ½æœ‰16384ä¸ªæ§½ï¼Œç¼–å·0-16383ï¼ˆ0\~2^14^-1ï¼‰ã€‚è¿™äº›æ§½ä¼šåˆ†é…ç»™é›†ç¾¤ä¸­çš„æ‰€æœ‰ä¸»èŠ‚ç‚¹ï¼Œåˆ†é…ç­–ç•¥æ²¡æœ‰è¦æ±‚ï¼Œå¯ä»¥æŒ‡å®šåˆ†é…ï¼Œé›†ç¾¤ä¼šè®°å½•èŠ‚ç‚¹å’Œæ§½çš„å¯¹åº”å…³ç³»ã€‚æ±‚è§£æ§½ä½`slot = CRC16(key) % 16384`ã€‚ä»¥æ§½ä¸ºå•ä½ç§»åŠ¨æ•°æ®ï¼Œå› ä¸ºæ§½çš„æ•°ç›®æ˜¯å›ºå®šçš„ï¼Œå¤„ç†èµ·æ¥æ¯”è¾ƒå®¹æ˜“ï¼Œè§£å†³äº†æ•°æ®ç§»åŠ¨é—®é¢˜ã€‚

![image-20230509202336810](assets/image-20230509202336810.png)



> ä¸ºä»€ä¹ˆRedisè¦è®¾è®¡16384ä¸ªæ§½ä½ï¼Ÿ
>
> [Redisä½œè€…å›ç­”](https://github.com/redis/redis/issues/2576)
>
> - å¦‚æœæ§½ä½ä¸º65536ï¼Œå‘é€å¿ƒè·³ä¿¡æ¯çš„æ¶ˆæ¯å¤´è¾¾8kï¼Œå‘é€çš„å¿ƒè·³åŒ…è¿‡äºåºå¤§
> - redisçš„é›†ç¾¤ä¸»èŠ‚ç‚¹æ•°é‡åŸºæœ¬ä¸å¯èƒ½è¶…è¿‡1000ä¸ª
> - æ§½ä½è¶Šå°ï¼ŒèŠ‚ç‚¹å°‘çš„æƒ…å†µä¸‹ï¼Œå‹ç¼©æ¯”é«˜



# Dockeræ­å»ºRedisé›†ç¾¤

> ç¯å¢ƒï¼š
>
> - Parallels Desktop
> - Ubuntu 22.04 ARM64
> - Docker 23.0..6
> - Redis 6.0.8



## 3ä¸»3ä»Redisé›†ç¾¤æ­å»º

### 1ï¼‰ å¯åŠ¨Docker

```shell
systemctl start docker
```

### 2ï¼‰æ–°å»º6ä¸ªRediså®ä¾‹

```shell
docker run -d --name redis-node-1 --net host --privileged=true -v /home/parallels/juzi/redis/share/redis-node-1:/data redis:6.0.8 --cluster-enabled yes --appendonly yes --port 6381
docker run -d --name redis-node-2 --net host --privileged=true -v /home/parallels/juzi/redis/share/redis-node-2:/data redis:6.0.8 --cluster-enabled yes --appendonly yes --port 6382
docker run -d --name redis-node-3 --net host --privileged=true -v /home/parallels/juzi/redis/share/redis-node-3:/data redis:6.0.8 --cluster-enabled yes --appendonly yes --port 6383
docker run -d --name redis-node-4 --net host --privileged=true -v /home/parallels/juzi/redis/share/redis-node-4:/data redis:6.0.8 --cluster-enabled yes --appendonly yes --port 6384
docker run -d --name redis-node-5 --net host --privileged=true -v /home/parallels/juzi/redis/share/redis-node-5:/data redis:6.0.8 --cluster-enabled yes --appendonly yes --port 6385
docker run -d --name redis-node-6 --net host --privileged=true -v /home/parallels/juzi/redis/share/redis-node-6:/data redis:6.0.8 --cluster-enabled yes --appendonly yes --port 6386
```

å‘½ä»¤è¯´æ˜ï¼š

- docker run => åˆ›å»ºå¹¶è¿è¡Œdockerå®¹å™¨å®ä¾‹
- -d => deamonæ¨¡å¼
- --name redis-node-? => rediså®ä¾‹åç§°
- --net host => ä½¿ç”¨å®¿ä¸»æœºçš„IPå’Œç«¯å£ï¼Œé»˜è®¤
- --privileged=true => è·å–å®¿ä¸»æœºrootæƒé™
- -v /home/parallels/juzi/redis/share/redis-node-1:/data => å®¹å™¨å·ï¼Œå®¿ä¸»æœºåœ°å€: dockerå†…éƒ¨åœ°å€
- redis:6.0.8 => redisé•œåƒå’Œç‰ˆæœ¬å·
- --cluster-enabled yes => å¼€å¯é›†ç¾¤
- --appendonly yes => å¼€å¯æŒä¹…åŒ–
- --port xxxx => rediså¯åŠ¨ç«¯å£å·

ã€æˆåŠŸå¯åŠ¨ã€‘

![image-20230509204428010](assets/image-20230509204428010.png)



### 3ï¼‰è¿›å…¥ä»»æ„ä¸€å°å®¹å™¨æ­å»ºé›†ç¾¤ç¯å¢ƒ

ã€Œä»¥redis-node-1ä¸ºä¾‹ã€

è¿›å…¥å®¹å™¨ï¼š

```shell
docker exec -it redis-node-1 /bin/bash
```

![image-20230509211834798](assets/image-20230509211834798.png)

æ­å»ºä¸»ä»å…³ç³»ï¼š

```shell
redis-cli --cluster create 10.211.55.3:6381 10.211.55.3:6382 10.211.55.3:6383 10.211.55.3:6384 10.211.55.3:6385 10.211.55.3:6386 --cluster-replicas 1
```

![image-20230509212018191](assets/image-20230509212018191.png)

![image-20230509212033604](assets/image-20230509212033604.png)

ã€è¯´æ˜ã€

- --cluster-replicas 1 => ä¸ºæ¯ä¸ªmasteråˆ›å»ºä¸€ä¸ªslaveèŠ‚ç‚¹
- 10.211.55.3æ¢æˆå®é™…çš„ipåœ°å€

è¿›å…¥èŠ‚ç‚¹ï¼ŒæŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼š

```shell
redis-cli -p 6381
```

```shell
cluster nodes
```

![image-20230509212121314](assets/image-20230509212121314.png)


```shell
cluster info
```

![image-20230509212140324](assets/image-20230509212140324.png)



## ä¸»ä»å®¹é”™ï¼Œåˆ‡æ¢è¿ç§»

### 1ï¼‰æ•°æ®è¯»å†™å­˜å‚¨

ä»¥é›†ç¾¤æ–¹å¼è¿›å…¥redisèŠ‚ç‚¹

```shell
docker exec -it redis-node-1 /bin/bash
```

```shell
redis-cli -p 6381 -c
```

![image-20230509212233709](assets/image-20230509212233709.png)

æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯

```sh
redis-cli --cluster check 10.211.55.3:6381
```

![image-20230509212259195](assets/image-20230509212259195.png)



### 2ï¼‰å®¹é”™åˆ‡æ¢è¿ç§»

æŸ¥çœ‹ç›®å‰ä¸»ä»èŠ‚ç‚¹çŠ¶å†µ

| master | slave |
| ------ | ----- |
| 6381   | 6385  |
| 6383   | 6384  |
| 6382   | 6386  |

ã€æ —å­ğŸŒ°ã€‘

å°†6381èŠ‚ç‚¹åœæ­¢æœåŠ¡ï¼ŒæŸ¥çœ‹ä¸»ä»çŠ¶æ€ã€é›†ç¾¤ä¿¡æ¯

```shell
docker stop redis-node-1
```

![image-20230509212706508](assets/image-20230509212706508.png)

å†æ¬¡å¯åŠ¨6381ï¼Œå‘ç°6381å¹¶ä¸ºæ¢å¤ä¸ºä¸»èŠ‚ç‚¹ï¼Œè€Œæ˜¯ä»èŠ‚ç‚¹

```sh
docker restart redis-node-1
```

![image-20230509212919464](assets/image-20230509212919464.png)

æ¢å¤åŸå…ˆçš„3ä¸»3ä»ï¼Œåœæ­¢6385å†é‡å¯6385å³å¯ï¼ˆéœ€è¦ç­‰å¾…ä¸€ä¼šå†é‡å¯ï¼‰

```sh
docker stop redis-node-5
docker restart redis-node-5
```

![image-20230509213328991](assets/image-20230509213328991.png)



## ä¸»ä»æ‰©å®¹

### 1ï¼‰æ–°å»º6387ã€6388ä¸¤ä¸ªredisèŠ‚ç‚¹

```sh
docker run -d --name redis-node-7 --net host --privileged=true -v /home/parallels/juzi/redis/share/redis-node-7:/data redis:6.0.8 --cluster-enabled yes --appendonly yes --port 6387
docker run -d --name redis-node-8 --net host --privileged=true -v /home/parallels/juzi/redis/share/redis-node-8:/data redis:6.0.8 --cluster-enabled yes --appendonly yes --port 6388
```

![image-20230509213535975](assets/image-20230509213535975.png)

### 2ï¼‰è¿›å…¥6387èŠ‚ç‚¹å†…éƒ¨

```sh
docker exec -it redis-node-7 /bin/bash
```

### 3ï¼‰å°†æ–°å¢çš„6387ä½œä¸ºmasterèŠ‚ç‚¹åŠ å…¥é›†ç¾¤

> redis-cli --cluster add-node è‡ªå·±å®é™…IPåœ°å€:6387 è‡ªå·±å®é™…IPåœ°å€:6381
>
> 6387 å°±æ˜¯å°†è¦ä½œä¸ºmasteræ–°å¢èŠ‚ç‚¹
>
> 6381ä¸å›ºå®šï¼Œåªè¦æ˜¯é›†ç¾¤å†…éƒ¨çš„èŠ‚ç‚¹å³å¯

```sh
redis-cli --cluster add-node 10.211.55.3:6387 10.211.55.3:6381
```

![image-20230509213749594](assets/image-20230509213749594.png)

### 4ï¼‰æ£€æŸ¥é›†ç¾¤çŠ¶æ€

```sh
redis-cli --cluster check 10.211.55.3:6387
```

![image-20230509213904082](assets/image-20230509213904082.png)

### 5ï¼‰é‡æ–°åˆ†é…æ§½ä½

> å‘½ä»¤:redis-cli --cluster **reshard** IPåœ°å€:ç«¯å£å·

```sh
redis-cli --cluster reshard 10.211.55.3:6381
```

![image-20230509214223942](assets/image-20230509214223942.png)

### 6ï¼‰æŸ¥çœ‹é›†ç¾¤çŠ¶æ€

```sh
redis-cli --cluster check 10.211.55.3:6387
```

![image-20230509214329917](assets/image-20230509214329917.png)

### 7ï¼‰ä¸ºä¸»èŠ‚ç‚¹6387åˆ†é…ä»èŠ‚ç‚¹6388

> å‘½ä»¤ï¼šredis-cli --cluster add-node ip:æ–°slaveç«¯å£ ip:æ–°masterç«¯å£ --cluster-slave --cluster-master-id æ–°ä¸»æœºèŠ‚ç‚¹ID

```sh
redis-cli --cluster add-node 10.211.55.3:6388 10.211.55.3:6387 --cluster-slave --cluster-master-id e08a5553e8074699e85880e9ae96b0552de87274
```

![image-20230509214631172](assets/image-20230509214631172.png)

### 8ï¼‰æŸ¥çœ‹é›†ç¾¤çŠ¶æ€

```sh
redis-cli --cluster check 10.211.55.3:6387
```

![image-20230509214734213](assets/image-20230509214734213.png)



## ä¸»ä»ç¼©å®¹

ç›®æ ‡ï¼šä»é›†ç¾¤ä¸­åˆ é™¤6387,6388èŠ‚ç‚¹

### 1ï¼‰æ£€æŸ¥é›†ç¾¤çŠ¶æ€è·å–6388èŠ‚ç‚¹ID

```sh
redis-cli --cluster check 10.211.55.3:6387
```

![image-20230509214947542](assets/image-20230509214947542.png)

### 2ï¼‰åˆ é™¤6388èŠ‚ç‚¹

> å‘½ä»¤ï¼šredis-cli --cluster del-node ip:ä»æœºç«¯å£ ä»æœº6388èŠ‚ç‚¹ID

```sh
redis-cli --cluster del-node 10.211.55.3:6388 9757d17ea25201c4b0317aaaf0f3ea714babdb26
```

![image-20230509215216816](assets/image-20230509215216816.png)

### 3ï¼‰æ¸…ç©º6387çš„æ§½ä½

ã€Œæœ¬ä¾‹ä¸­å°†æ§½ä½å…¨éƒ¨åˆ†é…ç»™6381ï¼Œå®é™…å¯ä»¥åˆ†é…ç»™å…¶ä»–å‡ ä¸ªä¸»èŠ‚ç‚¹ã€

```sh
redis-cli --cluster reshard 10.211.55.3:6381
```

![image-20230509215703635](assets/image-20230509215703635.png)

### 4ï¼‰æ£€æŸ¥é›†ç¾¤çŠ¶æ€

6387èŠ‚ç‚¹æ§½ä½å·²ç»è¢«æ¸…ç©º

![image-20230509215827517](assets/image-20230509215827517.png)

### 5ï¼‰åˆ é™¤6387èŠ‚ç‚¹

> å‘½ä»¤ï¼šredis-cli --cluster del-node ip:ç«¯å£ 6387èŠ‚ç‚¹ID

```sh
redis-cli --cluster del-node 10.211.55.3:6387 e08a5553e8074699e85880e9ae96b0552de87274
```

### 6ï¼‰æŸ¥çœ‹é›†ç¾¤çŠ¶æ€

![image-20230509220152149](assets/image-20230509220152149.png)
