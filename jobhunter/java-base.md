# JavaåŸºç¡€

# Javaåå°„çš„ä¼˜ç¼ºç‚¹ï¼Ÿ

> åå°„æ˜¯Javaè¯­è¨€é‡è¦çš„ä¸€ä¸ªç‰¹å¾ã€‚å®ƒèƒ½å¤Ÿåœ¨ç¨‹åºè¿è¡Œçš„è¿‡ç¨‹ä¸­å»æ„é€ ä»»æ„ä¸€ä¸ªç±»å¯¹è±¡ï¼Œå¹¶ä¸”å¯ä»¥è·å¾—ä»»æ„ä¸€ä¸ªç±»çš„æˆå‘˜å˜é‡ã€æˆå‘˜æ–¹æ³•ã€å±æ€§ï¼Œä»¥åŠè°ƒç”¨ä»»æ„ä¸€ä¸ªå¯¹è±¡çš„æ–¹æ³•ã€‚
>
> é€šè¿‡åå°„çš„èƒ½åŠ›ï¼Œå¯ä»¥è®©Javaè¯­è¨€æ”¯æŒåŠ¨æ€è·å–ç¨‹åºä¿¡æ¯ä»¥åŠåŠ¨æ€è°ƒç”¨æ–¹æ³•çš„èƒ½åŠ›ã€‚

Javaåå°„çš„ä¼˜ç‚¹ï¼š

- å¢åŠ ç¨‹åºçš„çµæ´»æ€§ï¼Œå¯ä»¥åœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­åŠ¨æ€å¯¹ç±»è¿›è¡Œä¿®æ”¹å’Œæ“ä½œ
- å¢åŠ ä»£ç çš„å¤ç”¨æ€§ï¼Œä¾‹å¦‚åŠ¨æ€ä»£ç†ï¼Œå°±æ˜¯ä½¿ç”¨äº†åå°„æŠ€æœ¯æ¥å®ç°
- å¯ä»¥åœ¨è¿è¡Œæ—¶è½»æ¾è·å–ä»»æ„ä¸€ä¸ªç±»çš„æ–¹æ³•ã€å±æ€§ï¼Œå¹¶ä¸”è¿˜èƒ½é€šè¿‡åå°„è¿›è¡ŒåŠ¨æ€è°ƒç”¨

Javaåå°„çš„ç¼ºç‚¹ï¼š

- åå°„ä¼šæ¶‰åŠåˆ°åŠ¨æ€ç±»å‹çš„è§£æï¼Œå› æ­¤JVMæ— æ³•å¯¹è¿™äº›ä»£ç è¿›è¡Œä¼˜åŒ–ï¼Œå¯¼è‡´æ€§èƒ½è¦æ¯”éåå°„è°ƒç”¨è¦ä½
- ä½¿ç”¨åå°„ä¹‹åï¼Œä»£ç çš„å¯è¯»æ€§ä¼šé™ä½
- åå°„å¯ä»¥ç»•è¿‡ä¸€äº›é™åˆ¶è®¿é—®çš„å±æ€§å’Œæ–¹æ³•(private, protected)ï¼Œå¯èƒ½ä¼šå¯¼è‡´ç ´åäº†ä»£ç æœ¬èº«çš„å°è£…æ€§å’ŒæŠ½è±¡æ€§

# Integer a1 = 100; Integer a2 = 100; a1 == a2 çš„è¿è¡Œç»“æœï¼Ÿ

> è€ƒæŸ¥çŸ¥è¯†ç‚¹ï¼š`==`è¡¨ç¤ºå†…å­˜åœ°å€åŒ¹é…ã€è£…ç®±æ‹†ç®±ã€Integerå†…éƒ¨è®¾è®¡åŸç†
>
> 1. `Integer a1 = 100`ï¼ŒæŠŠä¸€ä¸ªintæ•°å­—èµ‹å€¼ç»™ä¸€ä¸ªå°è£…ç±»å‹ï¼ŒJavaä¼šé»˜è®¤è¿›è¡Œè£…ç®±æ“ä½œï¼Œå³è°ƒç”¨äº†`Integer.valueOf()`æ–¹æ³•ï¼ŒæŠŠæ•°å­—100åŒ…è£…æˆå°è£…ç±»å‹`Integer`
>
> 2. åœ¨`Integer`å†…éƒ¨è®¾è®¡ä¸­ï¼Œä½¿ç”¨äº†**äº«å…ƒè®¾è®¡æ¨¡å¼**ï¼Œäº«å…ƒæ¨¡å¼çš„æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡å¤ç”¨å¯¹è±¡ï¼Œå‡å°‘å¯¹è±¡çš„åˆ›å»ºæ•°é‡ï¼Œä»è€Œå‡å°‘å†…å­˜å ç”¨å’Œæå‡æ€§èƒ½ã€‚
>
>    `Integer`å†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ª`IntegerCache`ï¼Œå…¶ç¼“å­˜äº†-128 \~ 127è¿™ä¸ªåŒºé—´çš„æ•°å€¼å¯¹åº”çš„Integerç±»å‹ã€‚
>
>    ```java
>    private static class IntegerCache {
>      static final int low = -128;
>      static final int high;
>      static final Integer cache[];
>    
>      static {
>        // high value may be configured by property
>        int h = 127;
>        String integerCacheHighPropValue =
>          VM.getSavedProperty("java.lang.Integer.IntegerCache.high");
>        if (integerCacheHighPropValue != null) {
>          try {
>            int i = parseInt(integerCacheHighPropValue);
>            i = Math.max(i, 127);
>            // Maximum array size is Integer.MAX_VALUE
>            h = Math.min(i, Integer.MAX_VALUE - (-low) -1);
>          } catch( NumberFormatException nfe) {
>            // If the property cannot be parsed into an int, ignore it.
>          }
>        }
>        high = h;
>    
>        cache = new Integer[(high - low) + 1];
>        int j = low;
>        for(int k = 0; k < cache.length; k++)
>          cache[k] = new Integer(j++);
>    
>        // range [-128, 127] must be interned (JLS7 5.1.7)
>        assert IntegerCache.high >= 127;
>      }
>    
>      private IntegerCache() {}
>    }
>    ```
>
>    ç¨‹åºè°ƒç”¨`valueOf`æ–¹æ³•ï¼Œå¦‚æœæ•°å­—æ˜¯åœ¨-128 \~ 127ä¹‹é—´å°±ç›´æ¥åœ¨cacheç¼“å­˜æ•°ç»„ä¸­å»å–Integerå¯¹è±¡ï¼Œå¦åˆ™å°±ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡
>
>    ```java
>    public static Integer valueOf(int i) {
>      if (i >= IntegerCache.low && i <= IntegerCache.high)
>        return IntegerCache.cache[i + (-IntegerCache.low)];
>      return new Integer(i);
>    }
>    ```

`a1==a2`çš„æ‰§è¡Œç»“æœä¸º`true`ï¼Œå› ä¸º`Integer`å†…éƒ¨ç”¨åˆ°äº†äº«å…ƒæ¨¡å¼ï¼Œé’ˆå¯¹-128 \~ 127ä¹‹é—´çš„æ•°å­—åšäº†ç¼“å­˜ï¼Œä½¿ç”¨`Integer a1 = 100`è¿™ä¸ªæ–¹å¼èµ‹å€¼æ—¶ï¼ŒJavaé»˜è®¤ä¼šé€šè¿‡`valueOf()`å¯¹100è¿™ä¸ªæ•°å­—è¿›è¡Œè£…ç®±æ“ä½œï¼Œä»è€Œè§¦å‘ç¼“å­˜æœºåˆ¶ï¼Œä½¿å¾—a1å’Œa2æŒ‡å‘äº†åŒä¸€ä¸ªIntegeråœ°å€ç©ºé—´ã€‚

# new String("abc")åˆ›å»ºäº†å‡ ä¸ªå¯¹è±¡ï¼Ÿ

ä»£ç ä¸­æœ‰ä¸€ä¸ª`new`å…³é”®å­—ï¼Œè¿™ä¸ªå…³é”®å­—æ˜¯åœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œæ ¹æ®å·²ç»åŠ è½½çš„ç³»ç»Ÿç±»`String`ï¼Œåœ¨å †å†…å­˜å†…å®ä¾‹åŒ–ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ã€‚ç„¶åï¼Œåœ¨`String`çš„æ„é€ æ–¹æ³•å†…éƒ¨ä¼ å…¥ä¸€ä¸ª`"abc"`å­—ç¬¦ä¸²ï¼Œå› ä¸º`String`å†…çš„å­—ç¬¦ä¸²æˆå‘˜å˜é‡æ˜¯`final`ä¿®é¥°çš„ï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡ã€‚æ¥ä¸‹æ¥ï¼ŒJVMä¼šæ‹¿å­—é¢é‡`"abc"`å»å­—ç¬¦ä¸²å¸¸é‡æ± å†…è¯•å›¾å»è·å–å®ƒå¯¹åº”çš„`String`å¯¹è±¡å¼•ç”¨ï¼Œå¦‚æœä¸èƒ½è·å–åˆ°ï¼Œå°±ä¼šåœ¨å †å†…å­˜é‡Œé¢åˆ›å»ºä¸€ä¸ª`"abc"`çš„`String`å¯¹è±¡ï¼Œå¹¶ä¸”æŠŠå¼•ç”¨ä¿å­˜åˆ°å­—ç¬¦ä¸²å¸¸é‡æ± å†…ã€‚åç»­æ“ä½œä¸­å¦‚æœå†æœ‰å¯¹å­—é¢é‡`"abc"`çš„å®šä¹‰ï¼Œç”±äºå­—ç¬¦ä¸²å¸¸é‡æ± å†…éƒ¨å·²ç»å­˜åœ¨å­—é¢é‡`"abc"`çš„å¼•ç”¨äº†ï¼Œæ‰€ä»¥åªéœ€è¦ä»å¸¸é‡æ± è·å–å¯¹åº”çš„å¼•ç”¨å°±å¯ä»¥äº†ï¼Œä¸éœ€è¦å†åˆ›å»ºã€‚

å› æ­¤ï¼Œè¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆæ˜¯ï¼š

- å¦‚æœ`"abc"`è¿™ä¸ªå­—ç¬¦ä¸²å¸¸é‡ä¸å­˜åœ¨ï¼Œåˆ™ä¼šåˆ›å»ºä¸¤ä¸ªå¯¹è±¡ï¼Œåˆ†åˆ«æ˜¯`"abc"`è¿™ä¸ªå­—ç¬¦ä¸²å¸¸é‡ä»¥åŠ`new String`è¿™ä¸ªå®ä¾‹å¯¹è±¡
- å¦‚æœ`"abc"`è¿™ä¸ªå­—ç¬¦ä¸²å¸¸é‡å­˜åœ¨ï¼Œåªä¼šåˆ›å»ºä¸€ä¸ªå®ä¾‹å¯¹è±¡ï¼Œå³`new String`

# HashMap å’Œ HashTableçš„åŒºåˆ«

> HashTable å’Œ HashMapéƒ½æ˜¯ä¸€ä¸ªåŸºäºhashè¡¨å®ç°çš„K-Vç»“æ„çš„é›†åˆ
>
> HashTableæ˜¯JDK1.0å¼•å…¥çš„ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„é›†åˆç±»ï¼Œå› ä¸ºæ‰€æœ‰æ•°æ®è®¿é—®çš„æ–¹æ³•éƒ½åŠ äº†ä¸€ä¸ªSynchronizedåŒæ­¥é”
>
> HashTableå†…éƒ¨é‡‡ç”¨æ•°ç»„åŠ é“¾è¡¨æ¥å®ç°ï¼Œé“¾è¡¨ç”¨æ¥è§£å†³hashå†²çªçš„é—®é¢˜
>
> HashMapæ˜¯JDK1.2å¼•å…¥çš„ä¸€ä¸ªçº¿ç¨‹ä¸å®‰å…¨çš„é›†åˆç±»ï¼ŒHashMapå†…éƒ¨ä¹Ÿæ˜¯é‡‡ç”¨äº†æ•°ç»„åŠ é“¾è¡¨å®ç°ï¼Œåœ¨JDK1.8ç‰ˆæœ¬é‡Œé¢åšäº†ä¼˜åŒ–ï¼Œå¼•å…¥äº†çº¢é»‘æ ‘ï¼Œå½“é“¾è¡¨é•¿åº¦å¤§äºç­‰äº8å¹¶ä¸”æ•°ç»„é•¿åº¦å¤§äº64çš„æ—¶å€™ï¼Œå°±ä¼šæŠŠé“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘ï¼Œæå‡æ•°æ®æŸ¥æ‰¾æ€§èƒ½

1. ä»åŠŸèƒ½ç‰¹æ€§çš„è§’åº¦æ¥çœ‹
   - HashTableæ˜¯çº¿ç¨‹å®‰å…¨çš„
   - HashMapä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„

2. HashMapçš„æ€§èƒ½è¦æ¯”HashTableæ›´å¥½ï¼Œå› ä¸ºHashTableé‡‡ç”¨äº†å…¨å±€åŒæ­¥é”æ¥ä¿è¯å®‰å…¨æ€§ï¼Œå¯¹æ€§èƒ½å½±å“è¾ƒå¤§

3. ä»å†…éƒ¨å®ç°çš„è§’åº¦æ¥çœ‹
   - HashTableä½¿ç”¨ æ•°ç»„ + é“¾è¡¨
   - HashMapä½¿ç”¨ æ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘

4. HashMapçš„åˆå§‹å®¹é‡æ˜¯16ï¼ŒHashTableçš„åˆå§‹å®¹é‡æ˜¯11

   ```java
   /**
    * Constructs a new, empty hashtable with a default initial capacity (11)
    * and load factor (0.75).
    */
   public Hashtable() {
     this(11, 0.75f);
   }
   ```

   ```java
   public class HashMap<K,V> extends AbstractMap<K,V>
     implements Map<K,V>, Cloneable, Serializable {
     // ...
     /**
      * The default initial capacity - MUST be a power of two.
      */
     static final int DEFAULT_INITIAL_CAPACITY = 1 << 4; // aka 16
   
     // ...
   }
   ```

   

5. HashMapå¯ä»¥ä½¿ç”¨nullä½œä¸ºkeyï¼Œå› ä¸ºHashMapä¼šæŠŠnullè½¬åŒ–ä¸º0è¿›è¡Œå­˜å‚¨ï¼Œè€ŒHashTableä¸å…è®¸

    `HashMap.java`
   ```java
   static final int hash(Object key) {
     int h;
     // å½“key == null çš„æ—¶å€™ï¼Œhashå€¼é»˜è®¤ä¸º0
     return (key == null) ? 0 : (h = key.hashCode()) ^ (h >>> 16);
   }
   ```

6. HashTableå’ŒHashMapçš„keyçš„æ•£åˆ—ç®—æ³•ä¸åŒ
   - HashTableä½¿ç”¨keyçš„hashcodeå¯¹æ•°ç»„é•¿åº¦åšå–æ¨¡
   - HashMapå¯¹keyçš„hashcodeåšäº†äºŒæ¬¡æ•£åˆ—ï¼Œä»è€Œé¿å…keyåˆ†å¸ƒä¸å‡åŒ€é—®é¢˜å½±å“åˆ°æŸ¥è¯¢æ€§èƒ½


# Stringã€StringBufferã€StringBuilderçš„åŒºåˆ«ï¼Ÿ

1. å¯å˜æ€§

   - `String`æ˜¯ä¸å¯å˜çš„

   - `StringBuilder`ä¸`StringBuffer`æ˜¯å¯å˜çš„ï¼Œå› ä¸ºå®ƒä»¬éƒ½ç»§æ‰¿è‡ª`AbstractStringBuilder`ç±»ï¼Œåœ¨`AbstractStringBuilder`ç±»ä¸­ä¹Ÿæ˜¯ä½¿ç”¨å­—ç¬¦æ•°ç»„æ¥ä¿å­˜å­—ç¬¦ä¸²ï¼Œåªä¸è¿‡æ²¡æœ‰ä½¿ç”¨`final`å’Œ`private`å…³é”®å­—ä¿®é¥°ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œ`AbstractStringBuilder`ç±»è¿˜æä¾›äº†å¾ˆå¤šä¿®æ”¹å­—ç¬¦ä¸²çš„æ–¹æ³•ï¼Œæ¯”å¦‚`append`æ–¹æ³•

     ```java
     abstract class AbstractStringBuilder implements Appendable, CharSequence {
       // ...
       byte[] value;
     
       public AbstractStringBuilder append(String str) {
         if (str == null) {
           return this.appendNull();
         } else {
           int len = str.length();
           this.ensureCapacityInternal(this.count + len);
           this.putStringAt(this.count, str);
           this.count += len;
           return this;
         }
       }
       // ...
     }
     ```

2. çº¿ç¨‹å®‰å…¨æ€§

   - `String`ä¸­çš„å¯¹è±¡æ˜¯ä¸å¯å˜çš„ï¼Œä¹Ÿå°±å¯ä»¥ç†è§£ä¸ºå¸¸é‡ï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„
   - `StringBuffer`å¯¹`AbstractStringBuilder`æä¾›çš„æ–¹æ³•åŠ äº†é”æˆ–è€…å¯¹è°ƒç”¨çš„æ–¹æ³•åŠ äº†åŒæ­¥é”ï¼Œæ‰€ä»¥æ˜¯çº¿ç¨‹å®‰å…¨çš„
   - `StringBuilder`æ²¡æœ‰å¯¹æ–¹æ³•åŠ é”ï¼Œæ‰€ä»¥æ˜¯éçº¿ç¨‹å®‰å…¨çš„

3. æ€§èƒ½

   æ¯æ¬¡å¯¹`String`ç±»å‹è¿›è¡Œæ”¹å˜çš„æ—¶å€™ï¼Œéƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„`String`å¯¹è±¡ï¼Œç„¶åå°†æŒ‡é’ˆæŒ‡å‘æ–°çš„`String`å¯¹è±¡ã€‚`StringBuffer`æ¯æ¬¡éƒ½ä¼šå¯¹`StringBuffer`å¯¹è±¡æœ¬èº«è¿›è¡Œæ“ä½œï¼Œè€Œä¸æ˜¯äº§ç”Ÿæ–°çš„å¯¹è±¡å¹¶æ”¹å˜å¯¹è±¡çš„å¼•ç”¨ã€‚ç›¸åŒæƒ…å†µä¸‹ä½¿ç”¨`StringBuilder`ç›¸æ¯”ä½¿ç”¨`StringBuffer`èƒ½è·å¾—10%\~15%å·¦å³çš„æ€§èƒ½æå‡ï¼Œä½†æ˜¯å¤šçº¿ç¨‹ä¸å®‰å…¨çš„é£é™©

**ã€æ€»ç»“ã€**

- æ“ä½œå°‘é‡æ•°æ®æ—¶ï¼Œé€‚ç”¨`String`
- å•çº¿ç¨‹æ“ä½œå­—ç¬¦ä¸²ç¼“å†²åŒºä¸‹æ“ä½œå¤§é‡æ•°æ®ï¼Œé€‚ç”¨`StringBuilder`
- å¤šçº¿ç¨‹æ“ä½œå­—ç¬¦ä¸²ç¼“å†²åŒºä¸‹æ“ä½œå¤§é‡æ•°æ®ï¼Œé€‚ç”¨`StringBuffer`



# Lockå’ŒSynchronizedçš„åŒºåˆ«

1ï¼‰åŠŸèƒ½è§’åº¦ï¼šLockå’ŒSynchronizedéƒ½æ˜¯Javaç”¨æ¥è§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜çš„å·¥å…·

2ï¼‰ç‰¹æ€§è§’åº¦

- Synchronizedæ˜¯Javaä¸­çš„åŒæ­¥å…³é”®å­—ï¼ŒLockæ˜¯JUCåŒ…ä¸­æä¾›çš„æ¥å£

- Synchronizedå¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼æ¥æ§åˆ¶é”çš„ç²’åº¦

	```java
	// ä¿®é¥°åœ¨æ–¹æ³•å±‚é¢
	public synchronized void sync() {
	  
	}
	
	Object lock = new Object();
	// ä¿®é¥°åœ¨ä»£ç å—
	public void sync() {
	  synchronized(lock) {
	  }
	}
	```

	ä¸€ç§æ˜¯æŠŠSynchronizedå…³é”®å­—ä¿®é¥°åœ¨æ–¹æ³•å±‚é¢ï¼›å¦ä¸€ç§æ˜¯ä¿®é¥°åœ¨ä»£ç å—ä¸Šï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥é€šè¿‡SynchronizedåŠ é”å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸæ¥æ§åˆ¶é”çš„ä½œç”¨èŒƒå›´ï¼Œæ¯”å¦‚é”å¯¹è±¡æ˜¯é™æ€å¯¹è±¡æˆ–è€…ç±»å¯¹è±¡ï¼Œé‚£ä¹ˆè¿™ä¸ªé”å°±æ˜¯å…¨å±€é”ï¼Œå¦‚æœé”å¯¹è±¡æ˜¯æ™®é€šå®ä¾‹å¯¹è±¡ï¼Œé‚£ä¹ˆè¿™ä¸ªé”çš„èŒƒå›´å°±å–å†³äºè¿™ä¸ªå®ä¾‹çš„ç”Ÿå‘½å‘¨æœŸã€‚

- Locké”çš„ç²’åº¦æ˜¯é€šè¿‡å®ƒé‡Œé¢æä¾›çš„`lock()`å’Œ`unlock()`æ–¹æ³•å†³å®šçš„ï¼ŒåŒ…è£¹åœ¨è¿™ä¸¤ä¸ªæ–¹æ³•ä¹‹é—´çš„ä»£ç èƒ½å¤Ÿä¿è¯çº¿ç¨‹å®‰å…¨æ€§ï¼Œè€Œé”çš„ä½œç”¨åŸŸå–å†³äºLockå®ä¾‹çš„å£°æ˜å‘¨æœŸã€‚

	```java
	Lock lock = new ReentrantLock();
	
	public void sync() {
	  // ç«äº‰é”
	  lock.lock();
	  // todo dosomething...
	  // é‡Šæ”¾é”
	  lock.unlock();
	}
	```

	Lockæ¯”Synchronizedçš„çµæ´»æ€§æ›´é«˜ï¼ŒLockå¯ä»¥è‡ªä¸»å†³å®šä»€ä¹ˆæ—¶å€™åŠ é”ï¼Œä»€ä¹ˆæ—¶å€™é‡Šæ”¾é”ï¼Œåªéœ€è¦è°ƒç”¨`lock()`å’Œ`unlock()`è¿™ä¸¤ä¸ªæ–¹æ³•å³å¯ï¼ŒåŒæ—¶Lockè¿˜æä¾›äº†éé˜»å¡çš„ç«äº‰é”æ–¹æ³•`trylock()`æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•é€šè¿‡è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼æ¥å‘Šè¯‰å½“å‰çº¿ç¨‹æ˜¯å¦æœ‰å…¶ä»–çº¿ç¨‹æ­£åœ¨ä½¿ç”¨é”ã€‚

	Synchronizedç”±äºæ˜¯å…³é”®å­—ï¼Œæ‰€ä»¥å®ƒæ— æ³•å®ç°éé˜»å¡ç«äº‰é”çš„æ–¹æ³•ï¼Œæ­¤å¤–ï¼ŒSynchronizedé”çš„é‡Šæ”¾æ˜¯è¢«åŠ¨çš„ï¼Œåªæœ‰å½“SynchronizedåŒæ­¥ä»£ç å—æ‰§è¡Œå®Œä»¥åæˆ–è€…ä»£ç å‡ºç°å¼‚å¸¸æ‰ä¼šé‡Šæ”¾ã€‚

- Lockæä¾›äº†å…¬å¹³é”å’Œéå…¬å¹³é”çš„æœºåˆ¶ï¼Œå…¬å¹³é”æ˜¯æŒ‡çº¿ç¨‹ç«äº‰é”èµ„æºçš„æ—¶å€™ï¼Œå¦‚æœå·²ç»æœ‰å…¶ä»–çº¿ç¨‹æ­£åœ¨æ’é˜Ÿç­‰å¾…é”é‡Šæ”¾ï¼Œé‚£ä¹ˆå½“å‰ç«äº‰é”èµ„æºçš„çº¿ç¨‹æ— æ³•æ’é˜Ÿã€‚éå…¬å¹³é”å°±æ˜¯ä¸ç®¡æ˜¯å¦æœ‰çº¿ç¨‹åœ¨æ’é˜Ÿç­‰å¾…é”ï¼Œä»–éƒ½ä¼šå°è¯•å»ç«äº‰ä¸€æ¬¡é”ã€‚Synchronizedåªæä¾›äº†ä¸€ç§éå…¬å¹³é”çš„å®ç°

3ï¼‰æ€§èƒ½æ–¹é¢ï¼šSynchronizedå’ŒLockåœ¨æ€§èƒ½å±‚é¢å·®åˆ«ä¸å¤§ï¼Œåœ¨å®ç°ä¸Šä¼šæœ‰ä¸€äº›åŒºåˆ«ï¼ŒSynchronizedå¼•å…¥åå‘é”ã€è½»é‡çº§é”ã€é‡é‡çº§é”å’Œé”å‡çº§çš„æ–¹å¼æ¥ä¼˜åŒ–é”çš„æ€§èƒ½ï¼Œè€ŒLockä¸­åˆ™ä½¿ç”¨åˆ°äº†è‡ªæ—‹é”çš„æ–¹å¼æ¥å®ç°æ€§èƒ½ä¼˜åŒ–ã€‚

# String\#internæ–¹æ³•çš„ä½œç”¨

```java
public native String intern();
```

`String#intern()`æ˜¯ä¸€ä¸ªnativeæ–¹æ³•ï¼Œèµ·ä½œç”¨æ˜¯å°†æŒ‡å®šçš„å­—ç¬¦ä¸²å¯¹è±¡çš„å¼•ç”¨ä¿å­˜åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œå¯ä»¥ç®€å•åˆ†ä¸ºä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼š

- å¦‚æœå­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ä¿å­˜äº†å¯¹åº”çš„å­—ç¬¦ä¸²å¯¹è±¡çš„å¼•ç”¨ï¼Œå°±ç›´æ¥è¿”å›è¯¥å¼•ç”¨
- å¦‚æœå­—ç¬¦ä¸²å¸¸é‡æ± æ²¡æœ‰ä¿å­˜å¯¹åº”çš„å­—ç¬¦ä¸²å¯¹è±¡çš„å¼•ç”¨ï¼Œå‘¢å°±åœ¨å¸¸é‡æ± ä¸­åˆ›å»ºä¸€ä¸ªæŒ‡å‘è¯¥å­—ç¬¦ä¸²å¯¹è±¡çš„å¼•ç”¨å¹¶è¿”å›

Demoï¼ˆJDK11ï¼‰

```java
public class Demo {
  public static void main(String[] args) {
    // åœ¨å †ä¸­åˆ›å»ºå­—ç¬¦ä¸²å¯¹è±¡â€Javaâ€œ
    // å°†å­—ç¬¦ä¸²å¯¹è±¡â€Javaâ€œçš„å¼•ç”¨ä¿å­˜åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­
    String s1 = "Java";
    // ç›´æ¥è¿”å›å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å­—ç¬¦ä¸²å¯¹è±¡â€Javaâ€œå¯¹åº”çš„å¼•ç”¨
    String s2 = s1.intern();
    // ä¼šåœ¨å †ä¸­åœ¨å•ç‹¬åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡
    String s3 = new String("Java");
    // ç›´æ¥è¿”å›å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å­—ç¬¦ä¸²å¯¹è±¡â€Javaâ€œå¯¹åº”çš„å¼•ç”¨
    String s4 = s3.intern();
    // s1 å’Œ s2 æŒ‡å‘çš„æ˜¯å †ä¸­çš„åŒä¸€ä¸ªå¯¹è±¡
    System.out.println(s1 == s2); // true
    // s3 å’Œ s4 æŒ‡å‘çš„æ˜¯å †ä¸­ä¸åŒçš„å¯¹è±¡
    System.out.println(s3 == s4); // false
    // s1 å’Œ s4 æŒ‡å‘çš„æ˜¯å †ä¸­çš„åŒä¸€ä¸ªå¯¹è±¡
    System.out.println(s1 == s4); //true
  }
}
```

output

```
true
false
true
```

# æ¥å£å’ŒæŠ½è±¡ç±»æœ‰ä»€ä¹ˆå…±åŒç‚¹å’ŒåŒºåˆ«ï¼Ÿ

**å…±åŒç‚¹ï¼š**

1. éƒ½ä¸èƒ½è¢«å®ä¾‹åŒ–
2. éƒ½å¯ä»¥åŒ…å«æŠ½è±¡æ–¹æ³•
3. éƒ½å¯ä»¥æœ‰é»˜è®¤å®ç°çš„æ–¹æ³•ï¼ˆJava8å¯ä»¥ä½¿ç”¨`default`å…³é”®å­—åœ¨æ¥å£ä¸­å®šä¹‰é»˜è®¤æ–¹æ³•ï¼‰

**åŒºåˆ«ï¼š**

1. æ¥å£ä¸»è¦ç”¨äºå¯¹ç±»çš„è¡Œä¸ºè¿›è¡Œçº¦æŸï¼Œå®ç°äº†æŸä¸ªæ¥å£å°±å…·æœ‰äº†å¯¹åº”çš„è¡Œä¸ºï¼›æŠ½è±¡ç±»ä¸»è¦æ˜¯ç”¨äºä»£ç å¤ç”¨ï¼Œå¼ºè°ƒçš„æ˜¯æ‰€å±å…³ç³»
2. ä¸€ä¸ªç±»åªèƒ½ç»§æ‰¿ä¸€ä¸ªç±»ï¼Œä½†æ˜¯å¯ä»¥å®ç°å¤šä¸ªæ¥å£
3. æ¥å£ä¸­çš„æˆå‘˜å˜é‡åªèƒ½æ˜¯`public static final`ç±»å‹çš„ï¼Œä¸èƒ½è¢«ä¿®æ”¹ä¸”å¿…é¡»æœ‰åˆå§‹å€¼ï¼Œè€ŒæŠ½è±¡ç±»çš„æˆå‘˜å˜é‡é»˜è®¤ä¸º`default`ï¼Œå¯åœ¨å­ç±»ä¸­è¢«é‡æ–°å®šä¹‰ï¼Œä¹Ÿå¯è¢«é‡æ–°èµ‹å€¼



# å¦‚ä½•ä½¿ç”¨`try-with-resources`ä»£æ›¿`try-catch-finally`?

1. é€‚ç”¨èŒƒå›´ï¼ˆèµ„æºçš„å®šä¹‰ï¼‰ï¼šä»»ä½•å®ç°`java.lang.AutoCloseable`æˆ–è€… `java.io.Closeable` çš„å¯¹è±¡
2. å…³é—­èµ„æºä¸finallyå—çš„æ‰§è¡Œé¡ºåºï¼šåœ¨`try-with-resource`ä¸­ï¼Œä»»ä½•catchå’Œfinallyè¯­å¥åœ¨å£°æ˜çš„èµ„æºå…³é—­åæ‰§è¡Œ


ã€æ —å­ğŸŒ°ã€‘ï¼šå•ä¸ªèµ„æº

`try-catch-finally`

```java
//è¯»å–æ–‡æœ¬æ–‡ä»¶çš„å†…å®¹
Scanner scanner = null;
try {
  scanner = new Scanner(new File("D://read.txt"));
  while (scanner.hasNext()) {
    System.out.println(scanner.nextLine());
  }
} catch (FileNotFoundException e) {
  e.printStackTrace();
} finally {
  if (scanner != null) {
    scanner.close();
  }
}
```

=> `try-with-resources`ï¼ˆJava7ä¹‹åï¼‰

```java
try (Scanner scanner = new Scanner(new File("test.txt"))) {
  while (scanner.hasNext()) {
    System.out.println(scanner.nextLine());
  }
} catch (FileNotFoundException fnfe) {
  fnfe.printStackTrace();
}
```

ã€æ —å­ğŸŒ°ã€‘ï¼šå¤šä¸ªèµ„æº

```java
try (BufferedInputStream bin = new BufferedInputStream(new FileInputStream(new File("test.txt")));
     BufferedOutputStream bout = new BufferedOutputStream(new FileOutputStream(new File("out.txt")))) {
  int b;
  while ((b = bin.read()) != -1) {
    bout.write(b);
  }
}
catch (IOException e) {
  e.printStackTrace();
}
```

# finallyä¸­çš„ä»£ç ä¸€å®šä¼šæ‰§è¡Œå—ï¼Ÿ

ä¸ä¸€å®šã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œfinallyå—ä¸­çš„ä»£ç ä¸ä¼šè¢«æ‰§è¡Œã€‚

1. finallyä¹‹å‰è™šæ‹Ÿæœºè¢«ç»ˆæ­¢è¿è¡Œï¼Œfinallyä¸­çš„ä»£ç ä¸ä¼šè¢«æ‰§è¡Œ

	```java
	try {
	  System.out.println("Try to do something");
	  throw new RuntimeException("RuntimeException");
	} catch (Exception e) {
	  System.out.println("Catch Exception -> " + e.getMessage());
	  // ç»ˆæ­¢å½“å‰æ­£åœ¨è¿è¡Œçš„Javaè™šæ‹Ÿæœº
	  System.exit(1);
	} finally {
	  System.out.println("Finally");
	}
	```

	Output:

	```
	Try to do something
	Catch Exception -> RuntimeException
	```

2. ç¨‹åºæ‰€åœ¨çš„çº¿ç¨‹æ­»äº¡

3. å…³é—­CPU

# Javaè®¿é—®ä¿®é¥°ç¬¦publicã€privateã€protectedï¼Œä»¥åŠæ— ä¿®é¥°ç¬¦(é»˜è®¤)çš„åŒºåˆ«

|  ä¿®é¥°ç¬¦   | å½“å‰ç±» | åŒåŒ… | å­åŒ… | å…¶ä»–åŒ… |
| :-------: | :----: | :--: | :--: | :----: |
|  public   |   âˆš    |  âˆš   |  âˆš   |   âˆš    |
| protected |   âˆš    |  âˆš   |  âˆš   |   Ã—    |
|  default  |   âˆš    |  âˆš   |  Ã—   |   Ã—    |
|  private  |   âˆš    |  Ã—   |  Ã—   |   Ã—    |

